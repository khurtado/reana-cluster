cluster:
  type: "kubernetes"
  version: "v1.14.0"
  db_config: &db_base_config
    - REANA_DB_NAME: "reana"
    - REANA_DB_HOST: "db"
    - REANA_DB_PORT: "5432"
  root_path: "/reana"
  shared_volume_path: &spath "/reana"
  db_persistence_path: "/reana/db"
  vc3_config: &vc3_user_id
    - VC3USERID: "FixMe"

  # When deploying a VC3 cluster, these are automatically filled.
  user_config: &workflow_user_id
    - WORKFLOW_RUNTIME_USER_UID: "FixMe"
    - WORKFLOW_RUNTIME_USER_GID: "FixMe"
    - WORKFLOW_RUNTIME_USER_NAME: "FixMe"
  shared_path: &shared_path
    - SHARED_VOLUME_PATH: *spath

components:
  reana-workflow-controller:
    type: "docker"
    image: "khurtado/reana-workflow-controller:vc3v2p2"
    mountpoints:
      - type: hostPath
        name: rjc-temp
        path: "/tmp:/tmp"
    environment:
      - <<: *db_base_config
      - <<: *workflow_user_id
      - <<: *shared_path
      - ORGANIZATIONS: "default,alice,atlas,cms,lhcb"
      - REANA_WORKFLOW_ENGINE_IMAGE_CWL: "khurtado/reana-workflow-engine-cwl:vc3v2p2"
      - REANA_WORKFLOW_ENGINE_IMAGE_YADAGE: "khurtado/reana-workflow-engine-yadage:vc3v2p2"
      - REANA_WORKFLOW_ENGINE_IMAGE_SERIAL: "khurtado/reana-workflow-engine-serial:vc3v2p2"
      - REANA_JOB_CONTROLLER_IMAGE: "khurtado/reana-job-controller:vc3v2p2"
        # To get HTCondor schedd address: $ condor_status -schedd -af MyAddress
      - REANA_JOB_CONTROLLER_VC3_HTCONDOR_ADDR: 'FixMe'
      - REANA_JOB_CONTROLLER_HOST_SHARE_TMPDIR: True

  reana-server:
    type: "docker"
    image: "khurtado/reana-server:vc3v2p2"
    environment:
      - <<: *db_base_config
      - <<: *shared_path
      - <<: *vc3_user_id

  reana-message-broker:
    type: "docker"
    image: "khurtado/reana-message-broker:latest"
